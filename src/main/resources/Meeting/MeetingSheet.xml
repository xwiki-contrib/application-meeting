<?xml version='1.0' encoding='UTF-8'?>
<xwikidoc version="1.1">
  <web>Meeting</web>
  <name>MeetingSheet</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <creator>XWiki.Admin</creator>
  <creationDate>1398818805000</creationDate>
  <parent>Meeting.MeetingClass</parent>
  <author>XWiki.Admin</author>
  <contentAuthor>XWiki.Admin</contentAuthor>
  <date>1399838135000</date>
  <contentUpdateDate>1399838135000</contentUpdateDate>
  <version>2.18</version>
  <title/>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>true</hidden>
  <content>{{velocity}}&#xd;
{{html wiki="true"}}&#xd;
$xwiki.ssx.use('AppWithinMinutes.ClassSheetGenerator')&#xd;
$xwiki.ssx.use('Meeting.SkinExtension')&#xd;
#set($discard = $doc.use('Meeting.MeetingClass'))&#xd;
#set($durationHour = $mathtool.floor($mathtool.div($doc.getValue('duration'),60)))&#xd;
#set($durationMinutes = $mathtool.sub($doc.getValue('duration'),$mathtool.mul(60,$durationHour)))&#xd;
#if($context.action=='view' &amp;&amp; $doc.get('hasBeenEdited') == 1)&#xd;
  #set($duration = $mathtool.add($mathtool.mul(60,$doc.getValue('durationHour')), $doc.getValue('durationMinutes')))&#xd;
  $doc.set('duration', "$duration.toString()")&#xd;
  $doc.set('durationString', $doc.get('calc'))&#xd;
  $doc.set('hasBeenEdited', 0)&#xd;
  $doc.save()&#xd;
#elseif($context.action!='view')&#xd;
  $doc.set('durationHour', $durationHour.toString())&#xd;
  $doc.set('durationMinutes', $durationMinutes.toString())&#xd;
  $doc.set('hasBeenEdited', 1)&#xd;
  $doc.save() &#xd;
#elseif(!$isGuest)   ##context==view &amp;&amp; !hasBeenEdited if duration has been changed through the calendar view&#xd;
  $doc.set('durationString', $doc.get('calc'))&#xd;
  $doc.set('durationHour', $durationHour.toString())&#xd;
  $doc.set('durationMinutes', $durationMinutes.toString())&#xd;
  $doc.save()&#xd;
#end&#xd;
#if($request.createPoll == 'true') &#xd;
  $doc.set('hasPoll', 1)&#xd;
  $doc.save()&#xd;
  #set($title="XPoll for the Meeting $doc.name")  &#xd;
  #set($newPollReference = $services.model.createDocumentReference('', 'XPoll', $title))&#xd;
  $response.sendRedirect($xwiki.getURL($newPollReference, 'edit', "$!{request.queryString}"))&#xd;
#end&#xd;
#if($request.sendNotification=='true')&#xd;
  #set($to = '')&#xd;
  #set($participants = $doc.getValue('participants'))&#xd;
  #set($list = $util.split($participants, ','))&#xd;
  #set($message = $msg.get('contrib.meeting.notification.body', ["$xwiki.getUserName($context.user)","&lt;strong>$doc.name&lt;/strong>"]))&#xd;
  #if($request.additionalMessage!='')&#xd;
    #set($message = "$message &lt;br> $msg.get('contrib.hr.notification.additionalPart') $request.additionalMessage")&#xd;
  #end&#xd;
  #set($title = $msg.get('contrib.meeting.notification.title'))&#xd;
  #set($link = $doc.getExternalURL())&#xd;
  #foreach($element in $list)&#xd;
    #set($email = $xwiki.getUserName($element, '$email', false))&#xd;
    #if($email!='$email' &amp;&amp; $email!='')&#xd;
      #set($to = "$to $email,")&#xd;
    #end&#xd;
  #end&#xd;
  #if($xwiki.mailsender.sendHtmlMessage("$context.user", $to, $xwiki.null, $xwiki.null, $title, "$message &lt;br> &lt;a href=$link> $msg.get('contrib.meeting.notification.link') &lt;/a>", "", "")==0)&#xd;
    $msg.get('contrib.meeting.notification.success')&#xd;
  #else&#xd;
    {{warning}}$msg.get('contrib.meeting.notification.failure'){{/warning}}&#xd;
  #end&#xd;
#end&#xd;
## We don't have access to the form element to set the CSS class for the vertical form layout standard.&#xd;
(% class="container-fluid form-group" %)&#xd;
(((&#xd;
  (% class="xform" %)&#xd;
  (((&#xd;
&#xd;
    (% class="row" %)&#xd;
    (((&#xd;
      (% class="col-md-12 col-sm-12 col-xs-12" %)&#xd;
      (((&#xd;
      ## Add a title of event in edit mode&#xd;
      #if($xcontext.action=='edit')&#xd;
          ; &lt;label for="Meeting.MeetingClass_0_meetingTitle">&lt;span class="glyphicon glyphicon-header">&lt;/span> $escapetool.xml($doc.displayPrettyName('meetingTitle', false, false))&lt;/label>&#xd;
          : $doc.display('meetingTitle')&#xd;
      #end&#xd;
      )))&#xd;
    )))&#xd;
&#xd;
    (% class="row" %)&#xd;
    (((&#xd;
      (% class="col-md-4 col-sm-12 col-xs-12" %)&#xd;
      (((&#xd;
      ; &lt;label for="Meeting.MeetingClass_0_startDate">&lt;span class="glyphicon glyphicon-calendar">&lt;/span> $msg.get('contrib.meeting.field.startDate')&lt;/label>##&#xd;
        (% class="xHint" %)$msg.get('')&#xd;
      : $doc.display('startDate')&#xd;
      )))&#xd;
      (% class="col-md-4 col-sm-12 col-xs-12" %)&#xd;
      (((&#xd;
      ; &lt;label for="Meeting.MeetingClass_0_status">&lt;span class="glyphicon glyphicon-play-circle">&lt;/span> $msg.get('contrib.meeting.field.status')&lt;/label>##&#xd;
        (% class="xHint" %)$msg.get('')&#xd;
      #if($context.action=='view')&#xd;
        : &lt;h5>&lt;span class="label label-warning">$doc.display('status')&lt;/span>&lt;/h5>&#xd;
      #else&#xd;
        : $doc.display('status')&#xd;
      #end&#xd;
      )))      &#xd;
      (% class="col-md-4 col-sm-12 col-xs-12" %)&#xd;
      (((&#xd;
      )))&#xd;
    )))&#xd;
&#xd;
    (% class="row" %)&#xd;
    (((    &#xd;
      (% class="col-md-4 col-sm-12 col-xs-12" %)&#xd;
      (((&#xd;
      ; &lt;label for="Meeting.MeetingClass_0_place">&lt;span class="glyphicon glyphicon-map-marker">&lt;/span> $msg.get('contrib.meeting.field.place')&lt;/label>##&#xd;
        (% class="xHint" %)$msg.get('')&#xd;
      : $doc.display('place')&#xd;
      )))&#xd;
      (% class="col-md-4 col-sm-12 col-xs-12" %)&#xd;
      (((&#xd;
      ; &lt;label for="Meeting.MeetingClass_0_calc">&lt;span class="glyphicon glyphicon-time">&lt;/span> $msg.get('contrib.meeting.field.duration')&lt;/label>##&#xd;
        (% class="xHint" %)$msg.get('')&#xd;
      #if($context.action=='view')&#xd;
        : $doc.display('durationString')&#xd;
      #else&#xd;
        ##: $doc.display('duration') &#xd;
        ##; &lt;label for="Meeting.MeetingClass_0_durationHour">$msg.get('contrib.meeting.field.duration')&lt;/label>&#xd;
        : &lt;div id="durationEdit"> $doc.display('durationHour') h $doc.display('durationMinutes') min&lt;/div>&#xd;
      #end&#xd;
      )))&#xd;
      (% class="col-md-4 col-sm-12 col-xs-12" %)&#xd;
      (((&#xd;
      ; &lt;label for="Meeting.MeetingClass_0_leader">&lt;span class="glyphicon glyphicon-user">&lt;/span> $msg.get('contrib.meeting.field.leader')&lt;/label>##&#xd;
        (% class="xHint" %)$msg.get('')&#xd;
      : $doc.display('leader')&#xd;
      )))&#xd;
    )))&#xd;
&#xd;
    (% class="row" %)&#xd;
    (((  &#xd;
      (% class="col-md-8 col-sm-12 col-xs-12" %)&#xd;
      (((&#xd;
      ; &lt;label for="Meeting.MeetingClass_0_description">&lt;span class="glyphicon glyphicon-list-alt">&lt;/span> $msg.get('contrib.meeting.field.description')&lt;/label>##&#xd;
        (% class="xHint" %)$msg.get('')&#xd;
      : $doc.display('description')&#xd;
      ; &lt;label for="Meeting.MeetingClass_0_notes">&lt;span class="glyphicon glyphicon-list-alt">&lt;/span> $msg.get('contrib.meeting.field.notes')&lt;/label>##&#xd;
        (% class="xHint" %)$msg.get('')&#xd;
      : $doc.display('notes')&#xd;
      )))&#xd;
&#xd;
      (% class="col-md-4 col-sm-12 col-xs-12" %)&#xd;
      (((&#xd;
      ; &lt;label for="Meeting.MeetingClass_0_participants">&lt;span class="glyphicon glyphicon-user">&lt;/span> $msg.get('contrib.meeting.field.participants')&lt;/label>##&#xd;
        (% class="xHint" %)$msg.get('')&#xd;
      : $doc.display('participants')&#xd;
&#xd;
      #if($doc.isCurrentUserCreator() &amp;&amp; $doc.getValue('participants')!='' &amp;&amp; $context.action=='edit')&#xd;
      &lt;form id="sendNotification" action='' method='post' class="form form-control">&#xd;
        &lt;div class='presentation'>&#xd;
          &lt;input type='hidden' name='sendNotification' value='true'>&#xd;
          &lt;label for='additionalMessage'>&lt;span class="glyphicon glyphicon-list-alt">&lt;/span> Notification&lt;/label>&#xd;
          &lt;textarea name="additionalMessage" cols='40' rows='4' placeholder="$msg.get('contrib.meeting.notification.additionalMessage')">&lt;/textarea>&#xd;
          &lt;span class='buttonwrapper'>&#xd;
            &lt;input type='submit' class='button' value="$msg.get('contrib.meeting.notification.submit')"/>&#xd;
          &lt;/span>&#xd;
        &lt;/div>&#xd;
      &lt;/form>&#xd;
      #end&#xd;
      )))&#xd;
    )))&#xd;
&#xd;
    (% class="row" %)&#xd;
    (((  &#xd;
    #if($doc.isCurrentUserCreator() &amp;&amp; $xwiki.exists('XPoll.WebHome') &amp;&amp; $doc.getValue('status')=='value1' &amp;&amp; $context.action=='view')&#xd;
      #if($doc.getValue('hasPoll')==0)&#xd;
        &lt;form id="createXPoll" action='' method='get'>&#xd;
          &lt;div class='presentation'>&#xd;
            &lt;input type='hidden' name='createPoll' value='true'>&#xd;
            &lt;input type="hidden" name="parent" value="Meeting.WebHome" />&#xd;
            &lt;input type="hidden" name="template" value="XPoll.XPollTemplate" />&#xd;
            &lt;span class='buttonwrapper'>&#xd;
              &lt;input type='submit' class='button' value="$msg.get('contrib.meeting.createPoll')"/>&#xd;
            &lt;/span>&#xd;
          &lt;/div>&#xd;
        &lt;/form>&#xd;
      #else&#xd;
        #set($url = $xwiki.getURL("XPoll.XPoll for the Meeting $doc.name"))&#xd;
        &lt;form action=$url method='post'>&#xd;
          &lt;div class='presentation'>&#xd;
            &lt;p>&lt;label>$msg.get('contrib.meeting.poll.explanation')&lt;/label>&lt;/p>&#xd;
            &lt;span class='buttonwrapper'>&#xd;
              &lt;input type='submit' class='button' value="$msg.get('contrib.meeting.poll.go')"/>&#xd;
            &lt;/span>&#xd;
          &lt;/div>&#xd;
        &lt;/form>&#xd;
      #end&#xd;
    #end&#xd;
    )))&#xd;
&#xd;
  ))) ## end of .xform&#xd;
))) ## end of .container-fluid&#xd;
{{/html}}&#xd;
{{/velocity}}&#xd;
</content>
</xwikidoc>